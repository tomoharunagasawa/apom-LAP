% for user-defined macro
% フォントを変更したつもり 
% \usepackage[dvipdfmx, noto, unicode]{pxchfon}
% \usepackage[deluxe]{luatexja-preset}
% \usepackage[noto,jis2004,unicode]{pxchfon}
% \usepackage[sfdefault]{noto}
\usepackage[T1]{fontenc}
% \usepackage[deluxe,jis2004,expert]{otf}
\renewcommand\kanjifamilydefault{\gtdefault}
\renewcommand\familydefault{\sfdefault}

% @<i>に明朝体を割り当て斜体にしない
% \renewcommand{\reviewit}[1]{\textsf{\userelfont\sffamily\mcfamily #1}}
\renewcommand{\reviewit}[1]{\textbf{\textrm{\userelfont\mcfamily #1}}}

% ヘッダーの変更
\fancyhead{}% 既存の設定をキャンセル
% \fancyhead[LE]{\gtfamily\sffamily\bfseries\upshape \leftmark}% 左ページなら左側の見出し情報（一般に章名）
% \lhead[\gtfamily\sffamily\bfseries\upshape \leftmark]{}
% \lhead[\gtfamily\sffamily\bfseries\upshape \leftmark]{}
% \rhead[]{\gtfamily\sffamily\bfseries\upshape \rightmark}

% 章見出しの変更

% 字下げをなくす
\setlength{\parindent}{0pt}

% 図の余白をなくす
% \setlength\intextsep{0pt}
% \setlength\textfloatsep{0pt}

% 禁則処理（和文約物の拡張）
\AtBeginDocument{%
  % 行頭禁則（この文字の前では改行しない）
  \prebreakpenalty"3001=10000 % 、 U+3001
  \prebreakpenalty"3002=10000 % 。 U+3002
  \prebreakpenalty"FF0C=10000 % ， U+FF0C
  \prebreakpenalty"FF0E=10000 % ． U+FF0E
  \prebreakpenalty"FF01=10000 % ！ U+FF01
  \prebreakpenalty"FF1F=10000 % ？ U+FF1F
  \prebreakpenalty"FF61=10000 % ｡ U+FF61（半角句点）
  \prebreakpenalty"300D=10000 % 」 U+300D
  \prebreakpenalty"300F=10000 % 』 U+300F
  \prebreakpenalty"FF3D=10000 % ］ U+FF3D
  \prebreakpenalty"FF09=10000 % ） U+FF09
  \prebreakpenalty"3009=10000 % 〉 U+3009
  \prebreakpenalty"300B=10000 % 》 U+300B
  \prebreakpenalty"3011=10000 % 】 U+3011

  % 行末禁則（この文字の後では改行しない）
  \postbreakpenalty"300C=10000 % 「 U+300C
  \postbreakpenalty"300E=10000 % 『 U+300E
  \postbreakpenalty"FF3B=10000 % ［ U+FF3B
  \postbreakpenalty"FF08=10000 % （ U+FF08
  \postbreakpenalty"3008=10000 % 〈 U+3008
  \postbreakpenalty"300A=10000 % 《 U+300A
  \postbreakpenalty"3010=10000 % 【 U+3010
}%

% コラムの見出し:「コラム」と表示しない, 見出し用フォント
\renewcommand{\reviewcolumnhead}[2]{%
{\noindent\headfont #2}}

% 章タイトルの上余白をなくす
\def\@makechapterhead#1{%
  %\vspace*{2\Cvs}% 欧文は50pt
  {\parindent \z@ \raggedright \normalfont
    \ifnum \c@secnumdepth >\m@ne
      \if@mainmatter
        \huge\headfont
		\@chapapp\thechapter\@chappos  
        \par\nobreak
        \vskip \Cvs % 欧文は20pt
      \fi
    \fi
    \interlinepenalty\@M
    \Huge \headfont #1\par\nobreak
    \vskip 1\Cvs}} % 欧文は40pt

\usepackage[x11names]{xcolor}
% セクション（モジュール）
\if@twocolumn
  \renewcommand{\section}{%
    \@startsection{section}{1}{\z@}%
    {0.6\Cvs}{0.4\Cvs}%
    {\normalfont\LARGE\headfont\raggedright\textcolor{yellow!50!black!90!white!30!red}}}
\else
  \renewcommand{\section}{%
    \if@slide\clearpage\fi
    \@startsection{section}{1}{\z@}%
    {\Cvs \@plus.5\Cdp \@minus.2\Cdp}% 前アキ
    {.5\Cvs \@plus.3\Cdp}% 後アキ
    {\normalfont\LARGE\headfont\raggedright\textcolor{white!40!green!55!blue}}}
\fi
	

% ドキュメント最初のページにも fancy スタイル適用
\AtBeginDocument{%
  \thispagestyle{fancy}
}

\usepackage[absolute,overlay]{textpos}
\usepackage{pxtextpos}
\newcommand{\myoverlayimage}{
  \begin{textblock*}{85mm}(60mm,\dimexpr\paperheight-6.0mm-2mm)
    % \includegraphics[height=5mm]{images/dasa.png}% 高さ20mmの画像貼り付け
	% {©2025 kanbanguides.org | All Rights Reserved.} 
  \end{textblock*}
}

% 今回用のフッターとヘッダーの設定（以下全部）
\usepackage{fancyhdr}
% \usepackage{url}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\setlength{\footskip}{5mm}

% 通常ページ
\fancyfoot[C]{%
  \begin{minipage}[t]{\textwidth}
    % {\color{white!10!green!30!blue!100!black!80!}\rule{\textwidth}{0.75pt}}\\[1.5ex]
    \footnotesize
    \raggedright
    \hfill\textnormal{©2025 Scrum.org | All Rights Reserved.　| \ \thepage}
  \end{minipage}
}

% plainスタイル（目次・章の頭など用）にも同じフッターを適用
\fancypagestyle{plain}{%
  \fancyhf{}
  \setlength{\footskip}{5mm}
  \fancyfoot[C]{%
    \begin{minipage}[t]{\textwidth}
      % {\color{white!10!green!30!blue!100!black!80!}\rule{\textwidth}{0.75pt}}\\[1.5ex]
      \footnotesize
      \raggedright
      \hfill\textnormal{©2025 Scrum.org | All Rights Reserved.　| \ \thepage}
    \end{minipage}
  }
}

% 指定位置に画像を表示する
%% \usepackage{everypage}
% \AddEverypageHook{
%   \myoverlayimage
% }

% % columnの本体デザイン変更
% \renewenvironment{reviewcolumn}[1][]{%
%     \vspace{\baselineskip}
%     \begin{tcolorbox}[breakable, colback=white, colframe=black!40!white, arc=1.5truemm, outer arc=1.8truemm, boxsep=5truemm]
%     \setlength{\parindent}{1zw}%
%     \reviewcolumnhead{}{#1}
%     \vspace{1zw}
%   }{%
%     \end{tcolorbox}
%     \vspace{\baselineskip}
%   }

% 図のキャプションを消す
\renewcommand\reviewimagecaption[1]{%
  \caption*{#1}}


% bothsidelineboxのカスタマイズ
%  - 左右線
\DeclareTColorBox{rv@bothsidelinebox@nocaption}{ O{} }{%
  enhanced,breakable,skin=enhancedmiddle,
  frame hidden,interior hidden,top=0mm,bottom=0mm,boxsep=0mm,
  borderline={0.4mm}{0mm}{black},
%   borderline={0.4mm}{0.4mm}{black!50},
%   borderline={0.4mm}{0.8mm}{black!10},
  before upper={\parindent\reviewtcb@zw{1}},
  fontupper={\userelfont\sffamily\gtfamily}, % 本文をゴシック体にする
  #1}

\DeclareTColorBox{rv@bothsidelinebox@caption}{ m O{} }{%
  enhanced,breakable,skin=enhancedmiddle,
  frame hidden,interior hidden,top=0mm,bottom=0mm,boxsep=0mm,
  borderline={0.4mm}{0mm}{black},
%   borderline={0.4mm}{0.4mm}{black!50},
%   borderline={0.4mm}{0.8mm}{black!10},
  before upper={\parindent\reviewtcb@zw{1}},
  coltitle=black,
  bottomtitle=2mm,
  fonttitle={\reviewtcb@gtfamily\sffamily\bfseries},
  title={#1},
  fontupper={\userelfont\sffamily\gtfamily}, % 本文をゴシック体にする
  #2}

% squarebox
%  - ごくシンプルな矩形
\DeclareTColorBox{rv@squarebox@nocaption}{ O{} }{%
empty, % スキン
left=3mm,right=5mm,top=6mm,bottom=7mm, % 内部パディング。デフォルトは4mm
arc=0mm, % コーナーの半径。デフォルトは1mm
% カラーは 色A!色Aの含み具合!色B。色Bを省略したときにはwhite
colback=white, %white, % 背景。デフォルトはblack!5!white
breakable, % ページ分断の許容
enhanced jigsaw, % 分断時に上下罫線を切り取り
pad at break=5.5mm, % 分断されたときの上下アキ。デフォルトは3.5mm
boxrule=0.0mm, % 線幅。toprule,bottomrule,leftrule,rightruleで個別指定も可
before upper={\setlength{\parindent}{0pt}\noindent\ignorespaces}, % 内容の1行目を字下げしない
fontupper={\userelfont\sffamily\gtfamily}, % 本文をゴシック体にする
#1} % オプション値で追加・上書き可能

\DeclareTColorBox{rv@squarebox@caption}{ m O{} }{%
empty,
left=3mm,right=5mm,top=6mm,bottom=7mm,
arc=0mm,
colback=white,
breakable,
enhanced jigsaw,
pad at break=4.5mm,
boxrule=.25mm,
before upper={\setlength{\parindent}{0pt}\noindent\ignorespaces}, % 内容の1行目を字下げしない
coltitle=black, % キャプション文字色
colbacktitle=white, % キャプション背景
fonttitle={\reviewtcb@gtfamily\sffamily\bfseries},
title={#1},
fontupper={\userelfont\sffamily\gtfamily}, % 本文をゴシック体にする
#2}

% leftsidelinebox
%  - 左線
\DeclareTColorBox{rv@leftsidelinebox@nocaption}{ O{} }{%
  enhanced,breakable,skin=enhancedmiddle,
  frame hidden,interior hidden,top=0mm,bottom=0mm,right=0mm,boxsep=0mm,
  borderline west={0.4mm}{0mm}{black}, % westを付けて左のみにする
%   borderline west={0.4mm}{0.4mm}{black!50},
%   borderline west={0.4mm}{0.8mm}{black!10},
  before upper={\parindent\reviewtcb@zw{1}},
  fontupper={\textsf{\userelfont\sffamily\gtfamily}}, % 本文をゴシック体にする
  #1}

\DeclareTColorBox{rv@leftsidelinebox@caption}{ m O{} }{%
  enhanced,breakable,skin=enhancedmiddle,
  frame hidden,interior hidden,top=0mm,bottom=0mm,right=0mm,boxsep=0mm,
  borderline west={0.4mm}{0mm}{black},
%   borderline west={0.4mm}{0.4mm}{black!50},
%   borderline west={0.4mm}{0.8mm}{black!10},
  before upper={\parindent\reviewtcb@zw{1}},
  coltitle=black,
  bottomtitle=2mm,
  fonttitle={\reviewtcb@gtfamily\sffamily\bfseries},
  title={#1},
  fontupper={\textsf{\userelfont\sffamily\gtfamily}}, % 本文をゴシック体にする
  #2}


% topsidelinebox
%  - 上線
\DeclareTColorBox{rv@topsidelinebox@nocaption}{ O{} }{%
enhanced,breakable,skin=enhancedmiddle,
frame hidden,interior hidden,top=0mm,bottom=3mm,right=2mm,boxsep=1mm,
borderline north={0.2mm}{0mm}{black}, % nouthを付けて上のみにする
borderline south={0.2mm}{0mm}{black}, % southを付けて下のみにする
%   borderline west={0.4mm}{0.4mm}{black!50},
%   borderline west={0.4mm}{0.8mm}{black!10},
before upper={\parindent\reviewtcb@zw{1}},
fontupper={\textsf{\userelfont\sffamily\gtfamily}}, % 本文をゴシック体にする
#1}

\DeclareTColorBox{rv@topsidelinebox@caption}{ m O{} }{%
enhanced,breakable,skin=enhancedmiddle,
frame hidden,interior hidden,top=0mm,bottom=3mm,right=2mm,boxsep=1mm,
borderline north={0.2mm}{0mm}{black}, % nouthを付けて下のみにする
borderline south={0.2mm}{0mm}{black}, % southを付けて下のみにする
%   borderline west={0.4mm}{0.4mm}{black!50},
%   borderline west={0.4mm}{0.8mm}{black!10},
before upper={\parindent\reviewtcb@zw{1}},
coltitle=black,
bottomtitle=2mm,
fonttitle={\textsf{\userelfont\sffamily\gtfamily}},
title={#1},
fontupper={\textsf{\userelfont\sffamily\gtfamily}}, % 本文をゴシック体にする
#2}

% 表の背景色を変える
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{review-custom}[2025/10/20 Table background color only]

\RequirePackage[table]{xcolor}
\RequirePackage{etoolbox}

% 添付の色（Material Blue Grey 200 相当）
\definecolor{ReviewTableBG}{HTML}{C6E6EC}

% 罫線の色はデフォルト（黒）のまま。太さ等は変更しない
% Re:VIEWの //table が内部で使う tabular/longtable に一括適用
\AtBeginEnvironment{tabular}{\rowcolors{1}{ReviewTableBG}{ReviewTableBG}}
\AtBeginEnvironment{longtable}{\rowcolors{1}{ReviewTableBG}{ReviewTableBG}}

% ---- 参考文献番号の後の改行を抑止 ----
% \RequirePackage{review-bib}
% ---- bibliography のぶら下げインデント（確実に後から上書き） ----
\makeatletter
\AtBeginDocument{%
  \@ifundefined{reviewbibpaper}{}{%
    \let\origreviewbibpaper\reviewbibpaper
    \renewcommand{\reviewbibpaper}[2]{%
      \par\begingroup
        \hangindent=2em    % ← ぶら下げ幅（好みで 1.5em〜2.5em）
        \hangafter=1
        \noindent [#1]\enspace #2\par
      \endgroup
    }%
  }%
}
\makeatother
% ------------------------------------------------------------------
\newcommand{\BibItem}[2]{%
  \noindent
  \hangindent=2em
  \hangafter=1
  [#1] #2\par
}